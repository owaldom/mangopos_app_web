<div class="payment-container">
    <h2 mat-dialog-title>Abono/Pago de Deuda - {{data.customer.name}}</h2>

    <mat-dialog-content>
        <div class="totals-summary">
            <div class="total-item">
                <label>Deuda Total (USD)</label>
                <span class="value-usd">$ {{data.customer.curdebt | number:totalFormat}}</span>
            </div>
            <div class="total-item" *ngIf="data.exchangeRate">
                <label>Equivalente en Bs.</label>
                <span class="value-bs">{{(data.customer.curdebt * data.exchangeRate) | number:totalFormat}} Bs.</span>
            </div>
        </div>

        <div class="invoice-selection">
            <mat-form-field appearance="outline" class="full-width">
                <mat-label>Seleccionar Factura (Saldo en USD)</mat-label>
                <mat-select [(ngModel)]="selectedInvoice" (selectionChange)="onInvoiceChange($event.value)">
                    <mat-option *ngFor="let inv of invoices" [value]="inv">
                        {{inv.dateInvoices}} - Saldo: $ {{inv.balance | number:totalFormat}}
                    </mat-option>
                </mat-select>
            </mat-form-field>
        </div>

        <div class="payment-amount-section">
            <div class="currency-tabs">
                <div class="tab-btn" [class.active]="selectedCurrency === 'base'" (click)="setCurrency('base')">Bs.
                </div>
                <div class="tab-btn" [class.active]="selectedCurrency === 'alt'" (click)="setCurrency('alt')">$ USD
                </div>
            </div>

            <div class="input-wrapper">
                <mat-form-field appearance="outline" *ngIf="selectedCurrency === 'base'" class="full-width">
                    <mat-label>Monto a Pagar (Bs)</mat-label>
                    <span matTextPrefix>Bs. &nbsp;</span>
                    <input matInput [(ngModel)]="amountBs" (ngModelChange)="onAmountBsChange($event)" appMoneyInput>
                </mat-form-field>

                <mat-form-field appearance="outline" *ngIf="selectedCurrency === 'alt'" class="full-width">
                    <mat-label>Monto a Pagar (USD)</mat-label>
                    <span matTextPrefix>$ &nbsp;</span>
                    <input matInput [(ngModel)]="amountUsd" (ngModelChange)="onAmountUsdChange($event)" appMoneyInput>
                </mat-form-field>
            </div>

            <div class="exchange-rate-details" *ngIf="data.exchangeRate">
                <span class="rate-label">Tasa: <strong>{{data.exchangeRate | number:'1.2-2'}}</strong></span>
                <span class="equivalent-hint" *ngIf="selectedCurrency === 'base'">Equivale a: <strong>$ {{amountUsd |
                        number:totalFormat}}</strong></span>
                <span class="equivalent-hint" *ngIf="selectedCurrency === 'alt'">Equivale a: <strong>{{amountBs |
                        number:totalFormat}} Bs.</strong></span>
            </div>
        </div>

        <div class="payment-methods">
            <div class="custom-method-btn" [class.active]="paymentMethod === 'cash'" (click)="setPaymentMethod('cash')">
                <mat-icon>payments</mat-icon>
                <span>Efectivo</span>
            </div>
            <div class="custom-method-btn" [class.active]="paymentMethod === 'card'" (click)="setPaymentMethod('card')">
                <mat-icon>credit_card</mat-icon>
                <span>Tarjeta</span>
            </div>
            <div class="custom-method-btn" [class.active]="paymentMethod === 'paper'"
                (click)="setPaymentMethod('paper')">
                <mat-icon>smartphone</mat-icon>
                <span>Pago Móvil</span>
            </div>
        </div>

        <div class="payment-details" [hidden]="paymentMethod === 'cash'">
            <div style="display: flex; gap: 8px; margin-bottom: 8px;">
                <mat-form-field appearance="outline" style="flex: 1;">
                    <mat-label>Referencia</mat-label>
                    <input matInput [(ngModel)]="reference" placeholder="Ref #">
                </mat-form-field>
                <mat-form-field appearance="outline" style="flex: 1;">
                    <mat-label>Banco</mat-label>
                    <input matInput [(ngModel)]="bank" placeholder="Nombre Banco">
                </mat-form-field>
            </div>
            <mat-form-field appearance="outline" [hidden]="paymentMethod !== 'paper'">
                <mat-label>Cédula</mat-label>
                <input matInput [(ngModel)]="cedula" placeholder="V-12345678">
            </mat-form-field>
        </div>
    </mat-dialog-content>

    <mat-dialog-actions class="actions">
        <button mat-button (click)="onCancel()" [disabled]="isLoading">Cancelar</button>
        <button mat-raised-button color="primary" [disabled]="!isValid() || isLoading" (click)="onConfirm()"
            [appLoading]="isLoading">
            Confirmar Pago
        </button>
    </mat-dialog-actions>
</div>