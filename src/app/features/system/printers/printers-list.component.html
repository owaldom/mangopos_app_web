<div class="printers-container">
    <div class="header">
        <h1>Configuración de Impresoras</h1>
        <p class="subtitle">Lista de impresoras detectadas en el servidor</p>
    </div>

    <div class="spinner-container" *ngIf="loading">
        <mat-spinner diameter="40"></mat-spinner>
    </div>

    <div class="content" *ngIf="!loading">
        <mat-card>
            <mat-card-content>
                <div class="empty-state" *ngIf="printers.length === 0">
                    <mat-icon>print_disabled</mat-icon>
                    <p>No se encontraron impresoras configuradas en el sistema.</p>
                    <button mat-stroked-button (click)="loadData()">Reintentar</button>
                </div>

                <!-- Roles Configuration -->
                <div class="roles-section" *ngIf="printers.length > 0">
                    <h3>Asignación de Roles</h3>
                    <div class="roles-grid">
                        <mat-form-field appearance="outline">
                            <mat-label>Comandas / Tickets</mat-label>
                            <mat-select [(ngModel)]="settings.roles.TICKET">
                                <mat-option value="">-- Predeterminada --</mat-option>
                                <mat-option *ngFor="let p of printers" [value]="p.name">
                                    {{p.name}}
                                </mat-option>
                            </mat-select>
                            <mat-icon matSuffix>receipt</mat-icon>
                        </mat-form-field>

                        <mat-form-field appearance="outline">
                            <mat-label>Facturas Fiscales</mat-label>
                            <mat-select [(ngModel)]="settings.roles.FISCAL">
                                <mat-option value="">-- Predeterminada --</mat-option>
                                <mat-option *ngFor="let p of printers" [value]="p.name">
                                    {{p.name}}
                                </mat-option>
                            </mat-select>
                            <mat-icon matSuffix>gavel</mat-icon>
                        </mat-form-field>

                        <mat-form-field appearance="outline">
                            <mat-label>Reportes / Cierre</mat-label>
                            <mat-select [(ngModel)]="settings.roles.REPORT">
                                <mat-option value="">-- Predeterminada --</mat-option>
                                <mat-option *ngFor="let p of printers" [value]="p.name">
                                    {{p.name}}
                                </mat-option>
                            </mat-select>
                            <mat-icon matSuffix>assessment</mat-icon>
                        </mat-form-field>
                    </div>

                    <div class="actions-row">
                        <button mat-raised-button color="primary" (click)="saveSettings()" [disabled]="saving">
                            <mat-icon>save</mat-icon>
                            {{ saving ? 'Guardando...' : 'Guardar Configuración' }}
                        </button>
                    </div>
                    <mat-divider class="spacer"></mat-divider>
                </div>

                <table mat-table [dataSource]="printers" *ngIf="printers.length > 0">

                    <ng-container matColumnDef="name">
                        <th mat-header-cell *matHeaderCellDef> Nombre </th>
                        <td mat-cell *matCellDef="let printer">
                            <strong>{{printer.name}}</strong>
                        </td>
                    </ng-container>

                    <ng-container matColumnDef="driver">
                        <th mat-header-cell *matHeaderCellDef> Controlador </th>
                        <td mat-cell *matCellDef="let printer"> {{printer.driver}} </td>
                    </ng-container>

                    <ng-container matColumnDef="status">
                        <th mat-header-cell *matHeaderCellDef> Estado </th>
                        <td mat-cell *matCellDef="let printer">
                            <span class="status-badge" [class.ready]="printer.status === 'Ready'">
                                {{printer.status}}
                            </span>
                        </td>
                    </ng-container>

                    <ng-container matColumnDef="actions">
                        <th mat-header-cell *matHeaderCellDef> Acciones </th>
                        <td mat-cell *matCellDef="let printer">
                            <button mat-button color="primary" (click)="testPrinter(printer.name)">
                                <mat-icon>print</mat-icon> Prueba
                            </button>
                        </td>
                    </ng-container>

                    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                    <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
                </table>
            </mat-card-content>
        </mat-card>
    </div>
</div>